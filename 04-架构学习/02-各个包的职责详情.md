# OpenCode 项目 - 各个包的职责详情

> 本文档详细说明了 OpenCode 项目中所有 19 个包的职责、功能、技术栈和依赖关系。

## 目录

- [项目概览](#项目概览)
- [核心包](#核心包)
- [控制台相关包](#控制台相关包)
- [客户端包](#客户端包)
- [集成包](#集成包)
- [工具和基础设施包](#工具和基础设施包)
- [架构总结](#架构总结)

---

## 项目概览

**OpenCode** 是一个开源的 AI 编码代理工具，采用 CLI/服务器架构，提供多种客户端（TUI、Web、桌面、VS Code）和丰富的集成能力。

### 项目结构

- **Monorepo 管理**: Bun Workspaces
- **主要语言**: TypeScript
- **运行时**: Bun（主要）、Node.js
- **版本**: 1.0.207

### 包分类

1. **核心包** (1个): CLI 核心
2. **控制台相关包** (5个): 管理控制台和 API 网关
3. **客户端包** (3个): Web、桌面、VS Code
4. **集成包** (5个): Slack、GitHub、企业版、函数服务
5. **工具和基础设施包** (5个): SDK、UI、工具函数等

---

## 核心包

### 1. packages/opencode - CLI 核心包

**包名**: `opencode`

**主要功能**:
- OpenCode 的核心 CLI 工具
- 实现主要的交互式终端用户界面（TUI）
- 文件系统操作、代码编辑、LSP 集成
- MCP（Model Context Protocol）客户端
- 插件系统
- AI Agent 执行引擎

**技术栈**:
- Bun（JavaScript 运行时）
- AI SDK（多提供商支持）
- tree-sitter（代码解析）
- web-tree-sitter
- ghostty-web（终端）
- Hono（API 服务器）
- diff（代码差异）

**依赖关系**:
- **依赖**: `@opencode-ai/plugin`, `@opencode-ai/script`, `@opencode-ai/sdk`, `@opencode-ai/util`
- **被依赖**: 其他包使用其功能

**关键文件/模块**:
- `src/index.ts` - CLI 入口，所有命令定义
- `src/cli/cmd/run.ts` - 运行会话
- `src/cli/cmd/tui/` - TUI 相关
- `src/cli/cmd/auth.ts` - 认证命令
- `src/cli/cmd/agent.ts` - Agent 管理
- `src/cli/cmd/models.ts` - 模型管理
- `src/cli/cmd/github.ts` - GitHub 集成
- `src/cli/cmd/mcp.ts` - MCP 相关
- `src/agent/` - Agent 系统
- `src/lsp/` - LSP 客户端和服务器
- `src/provider/` - AI 提供商集成
- `src/project/` - 项目管理
- `src/file/` - 文件操作
- `src/plugin/` - 插件加载器
- `src/acp/` - Agent Client Protocol
- `src/session/` - 会话管理
- `src/command/` - 命令执行
- `src/mcp/` - MCP 协议实现

**主要命令**:
- `opencode` / `opencode run` - 启动交互式会话
- `opencode auth` - 认证管理
- `opencode agent` - Agent 配置
- `opencode models` - 模型管理
- `opencode github` - GitHub 集成
- `opencode mcp` - MCP 服务器管理
- `opencode serve` - 启动 API 服务器
- `opencode debug` - 调试工具

**地位**: 整个项目的核心，所有功能的主要实现。

---

## 控制台相关包

控制台相关包负责 OpenCode 的管理控制台，包括 API 网关、用户管理、计费等功能。

### 2. packages/console/app - 控制台应用

**包名**: `@opencode-ai/console-app`

**主要功能**:
- OpenCode 的管理控制台 Web 应用
- 提供 OpenCode Zen API（OpenAI 兼容的模型网关）
- 处理用户认证、授权、工作区管理
- Stripe 计费集成
- 提供管理仪表板和 API 文档
- 处理桌面应用反馈和下载

**技术栈**:
- SolidStart（全栈 SolidJS 框架）
- Nitro（服务端渲染）
- Chart.js（数据可视化）
- OpenAuth（认证）
- IBM Plex 字体

**依赖关系**:
- **依赖**: `@opencode-ai/console-core`, `@opencode-ai/console-mail`, `@opencode-ai/console-resource`, `@opencode-ai/ui`
- **协作**: 与其他控制台包紧密协作

**关键文件/模块**:
- `src/routes/zen/v1/models.ts` - 模型列表端点
- `src/routes/zen/v1/messages.ts` - 消息/聊天完成端点
- `src/routes/zen/v1/chat/completions.ts` - OpenAI 兼容的聊天完成
- `src/routes/zen/util/provider/` - 多个提供商集成（Anthropic、OpenAI、Google）
- `src/routes/auth/` - 认证流程
- `src/routes/stripe/webhook.ts` - Stripe webhook 处理
- `src/routes/download/[platform].ts` - 桌面应用下载
- `src/context/` - 认证上下文

**地位**: 控制台的前端应用，提供 API 网关和管理界面。

---

### 3. packages/console/core - 控制台核心

**包名**: `@opencode-ai/console-core`

**主要功能**:
- 控制台的后端核心逻辑和数据访问层
- 数据库模型和迁移（Drizzle ORM）
- 用户、工作区、密钥、模型管理
- Stripe 计费逻辑
- AWS 集成（STS、凭证）
- 模型管理工具（更新、推广）

**技术栈**:
- Drizzle ORM 0.41.0（数据库 ORM）
- PlanetScale Database（MySQL 兼容）
- Stripe 18.0.0（支付）
- AWS SDK（STS）
- Zod（验证）

**依赖关系**:
- **依赖**: `@opencode-ai/console-mail`, `@opencode-ai/console-resource`
- **被依赖**: 被所有控制台应用包依赖

**关键文件/模块**:
- `src/schema/account.sql.ts` - 账户表
- `src/schema/user.sql.ts` - 用户表
- `src/schema/workspace.sql.ts` - 工作区表
- `src/schema/key.sql.ts` - API 密钥表
- `src/schema/model.sql.ts` - 模型配置表
- `src/schema/billing.sql.ts` - 计费相关表
- `src/account.ts` - 账户管理
- `src/user.ts` - 用户管理
- `src/workspace.ts` - 工作区管理
- `src/key.ts` - API 密钥管理
- `src/model.ts` - 模型管理
- `src/billing.ts` - 计费逻辑
- `src/aws.ts` - AWS 集成
- `script/` - 数据库和模型管理脚本

**地位**: 控制台的数据层和业务逻辑核心。

---

### 4. packages/console/function - 控制台函数服务

**包名**: `@opencode-ai/console-function`

**主要功能**:
- 无服务器函数（部署在 Cloudflare Workers）
- 处理日志处理任务
- 处理认证相关的异步任务

**技术栈**:
- Hono（轻量级 Web 框架）
- Cloudflare Workers
- AI SDK（Anthropic、OpenAI）

**依赖关系**:
- **依赖**: `@opencode-ai/console-core`, `@opencode-ai/console-resource`

**关键文件/模块**:
- `src/log-processor.ts` - 日志处理函数
- `src/auth.ts` - 认证相关函数

**地位**: 控制台的无服务器后端函数。

---

### 5. packages/console/mail - 控制台邮件服务

**包名**: `@opencode-ai/console-mail`

**主要功能**:
- 邮件模板系统
- 发送邀请邮件等事务性邮件
- 基于 JSX Email 的邮件模板

**技术栈**:
- JSX Email（React 风格的邮件模板）
- SolidJS（用于某些组件）

**依赖关系**:
- **被使用**: 被 `@opencode-ai/console-core` 使用

**关键文件/模块**:
- `emails/templates/InviteEmail.tsx` - 邀请邮件模板
- `emails/components.tsx` - 邮件组件

**地位**: 控制台的邮件服务模块。

---

### 6. packages/console/resource - 控制台资源

**包名**: `@opencode-ai/console-resource`

**主要功能**:
- 提供环境特定的资源抽象
- Node.js 和 Cloudflare Workers 的条件导出
- SST 资源绑定

**技术栈**:
- Cloudflare Workers Types
- TypeScript 条件类型

**依赖关系**:
- **被依赖**: 被所有控制台包依赖

**关键文件/模块**:
- `resource.node.ts` - Node.js 环境资源
- `resource.cloudflare.ts` - Cloudflare Workers 环境资源

**地位**: 控制台资源抽象层。

---

## 客户端包

客户端包提供不同平台上的用户界面。

### 7. packages/app - SolidJS Web 应用

**包名**: `@opencode-ai/app`

**主要功能**:
- 基于 SolidJS 的 Web 前端应用
- 提供终端用户界面（TUI）的 Web 版本
- 实现会话管理、消息展示、代码差异视图
- 集成 Web Socket 实时通信
- 支持多目录会话管理

**技术栈**:
- SolidJS 1.9.10（响应式前端框架）
- Solid Router（路由）
- Kobalte（UI 组件基础）
- TailwindCSS 4.1.11（样式）
- Ghostty Web（终端模拟器）
- Marked + Shiki（Markdown 和代码高亮）

**依赖关系**:
- **依赖**: `@opencode-ai/sdk`, `@opencode-ai/ui`, `@opencode-ai/util`
- **被依赖**: `@opencode-ai/desktop`

**关键文件/模块**:
- `src/index.ts` - 入口，导出 PlatformProvider 和 App
- `src/app.tsx` - 主应用组件，包含路由和所有 Provider
- `src/pages/session.tsx` - 会话页面
- `src/pages/layout.tsx` - 布局组件
- `src/context/` - 各种上下文（终端、提示词、通知、命令等）
- `src/hooks/` - 自定义 hooks
- `src/utils/` - 工具函数（DOM、持久化、提示词、语音）

**地位**: Web 应用的核心，也是桌面应用的基础。

---

### 8. packages/desktop - Tauri 桌面应用

**包名**: `@opencode-ai/desktop`

**主要功能**:
- 基于 Tauri 2.x 的跨平台桌面应用
- 封装 Web 应用（packages/app）为原生桌面应用
- 提供自动更新功能
- 原生对话框、文件系统访问、Shell 集成

**技术栈**:
- Tauri 2.x（桌面应用框架）
- SolidJS
- Vite（构建工具）

**依赖关系**:
- **依赖**: `@opencode-ai/app`
- **被依赖**: 独立发布的应用

**关键文件/模块**:
- `src-tauri/` - Tauri 配置和 Rust 代码
- `src/updater.ts` - 自动更新逻辑
- `src/menu.ts` - 应用菜单
- `scripts/predev.ts` - 开发前脚本

**地位**: 桌面应用的打包层。

---

### 9. sdks/vscode - VS Code 扩展

**包名**: `opencode` (VS Code)

**主要功能**:
- VS Code 扩展
- 在集成终端中启动 opencode
- 快捷键绑定
- 文件引用快捷插入
- 自动共享当前选择或标签页

**技术栈**:
- VS Code Extension API
- TypeScript
- esbuild（构建）

**依赖关系**:
- **依赖**: 系统安装 opencode CLI
- **被依赖**: 独立的 VS Code 扩展

**关键文件/模块**:
- `src/extension.ts` - 扩展主入口
- 命令注册
- 终端管理

**提供的命令**:
- `opencode.openTerminal` (Cmd+Esc / Ctrl+Esc) - 打开 opencode
- `opencode.openNewTerminal` (Cmd+Shift+Esc / Ctrl+Shift+Esc) - 新建会话
- `opencode.addFilepathToTerminal` (Cmd+Option+K / Ctrl+Alt+K) - 插入文件引用

**地位**: VS Code 集成。

---

## 集成包

集成包提供与第三方服务的集成。

### 10. packages/function - 函数服务

**包名**: `@opencode-ai/function`

**主要功能**:
- Cloudflare Workers Durable Object（SyncServer）
- 实现会话共享功能
- GitHub App Token 交换
- R2 存储集成
- WebSocket 实时同步

**技术栈**:
- Cloudflare Workers
- Hono
- Durable Objects
- R2（对象存储）
- Octokit（GitHub API）
- JOSE（JWT 验证）

**依赖关系**:
- **被使用**: 被 CLI 和 GitHub Action 使用

**关键文件/模块**:
- `src/api.ts` - 主 API 文件
  - `SyncServer` - Durable Object 类
    - `share()` - 创建共享链接
    - `publish()` - 发布更新
    - `getData()` - 获取会话数据
    - `clear()` - 清除会话
  - `/share_create` - 创建共享端点
  - `/share_sync` - 同步端点
  - `/share_poll` - WebSocket 轮询端点
  - `/exchange_github_app_token` - GitHub Token 交换
  - `/exchange_github_app_token_with_pat` - 使用 PAT 交换 Token
  - `/get_github_app_installation` - 检查 GitHub App 安装状态

**地位**: 会话共享和 GitHub 集成的后端服务。

---

### 11. packages/slack - Slack 集成

**包名**: `@opencode-ai/slack`

**主要功能**:
- Slack Bot 集成
- 响应提及和消息
- 创建线程化的 opencode 会话
- Socket Mode 支持

**技术栈**:
- @slack/bolt（Slack SDK）
- @opencode-ai/sdk

**依赖关系**:
- **依赖**: `@opencode-ai/sdk`
- **被依赖**: 独立运行的 Bot 服务

**关键文件/模块**:
- `src/index.ts` - Bot 主入口
- Slack 事件处理
- 会话管理

**环境变量**:
- `SLACK_BOT_TOKEN`
- `SLACK_SIGNING_SECRET`
- `SLACK_APP_TOKEN`

**地位**: Slack 集成。

---

### 12. github - GitHub 集成

**包名**: `github`

**主要功能**:
- GitHub Action 集成
- 响应 issue 和 PR 评论
- 代码审查和自动修复
- GitHub App 集成
- OIDC 认证

**技术栈**:
- @actions/core, @actions/github（GitHub Actions SDK）
- @octokit/rest（GitHub API）
- @opencode-ai/sdk

**依赖关系**:
- **依赖**: `@opencode-ai/sdk`
- **被依赖**: 作为 GitHub Action 使用

**关键文件/模块**:
- `index.ts` - Action 主入口
- GitHub 事件处理
- 代码补丁和提交

**触发条件**:
- issue 评论（包含 `/opencode` 或 `/oc`）
- PR 评论
- PR 审查评论（特定代码行）

**功能**:
- 解释 issue
- 修复问题（创建分支和 PR）
- 审查 PR 并应用修改
- 特定代码行审查

**地位**: GitHub 集成。

---

### 13. packages/enterprise - 企业版功能

**包名**: `@opencode-ai/enterprise`

**主要功能**:
- 企业版功能模块
- 部署在 Cloudflare Workers
- 提供 AWS 签名凭证生成
- 代码差异查看和比较

**技术栈**:
- SolidStart
- Hono
- aws4fetch（AWS 签名）
- @pierre/diffs（代码差异）

**依赖关系**:
- **依赖**: `@opencode-ai/util`, `@opencode-ai/ui`

**关键文件/模块**:
- 企业版特定功能实现
- AWS 凭证签名端点
- 代码差异查看器

**地位**: 企业版功能。

---

## 工具和基础设施包

工具和基础设施包提供共享功能和服务。

### 14. packages/sdk/js - JavaScript/TypeScript SDK

**包名**: `@opencode-ai/sdk`

**主要功能**:
- 提供客户端和服务器 SDK
- 自动生成的类型安全 API 客户端
- OpenAPI 规范生成
- 支持 v1 和 v2 版本

**技术栈**:
- TypeScript
- hey-api/openapi-ts（代码生成）
- Hono OpenAPI

**依赖关系**:
- **被依赖**: 被所有客户端使用（CLI、Web、Slack、GitHub）

**关键文件/模块**:
- `src/index.ts` - 主入口，导出 `createOpencode`
- `src/client.ts` - 客户端实现
- `src/server.ts` - 服务器实现
- `src/v2/` - v2 版本
- `src/gen/` - 自动生成的代码
  - `client.gen.ts` - 客户端生成
  - `sdk.gen.ts` - SDK 类型
  - `core/` - 核心工具（序列化、认证、SSE）

**导出的主要类型**:
- `createOpencodeClient` - 创建客户端
- `createOpencodeServer` - 创建服务器
- Event、Project、Model、Provider、Permission、Message 等类型

**地位**: API 通信的抽象层。

---

### 15. packages/ui - UI 组件库

**包名**: `@opencode-ai/ui`

**主要功能**:
- 共享的 UI 组件库
- 基于 Kobalte 的无障碍组件
- 代码高亮和差异显示
- Markdown 渲染
- 主题系统
- 图标和字体

**技术栈**:
- SolidJS
- Kobalte（无障碍组件基础）
- TailwindCSS
- Shiki（代码高亮）
- Marked（Markdown 解析）
- @pierre/diffs（代码差异）
- Fuzzysort（模糊搜索）

**依赖关系**:
- **依赖**: `@opencode-ai/sdk`, `@opencode-ai/util`
- **被依赖**: 被 `@opencode-ai/app` 和 `@opencode-ai/console-app` 使用

**关键文件/模块**:
- `src/components/button.tsx` - 按钮组件
- `src/components/dialog.tsx` - 对话框组件
- `src/components/dropdown-menu.tsx` - 下拉菜单组件
- `src/components/code.tsx` - 代码高亮组件
- `src/components/diff.tsx` - 代码差异显示组件
- `src/components/markdown.tsx` - Markdown 渲染组件
- `src/components/spinner.tsx` - 加载指示器组件
- `src/components/toast.tsx` - 通知组件
- `src/components/message-part.tsx` - 消息部分组件
- `src/components/session-turn.tsx` - 会话轮次组件
- `src/context/` - 组件上下文
- `src/theme/` - 主题系统
- `src/hooks/` - 自定义 hooks
- `src/pierre/` - Pierre 差异显示集成
- `src/assets/` - 字体、音频、图标

**地位**: UI 组件共享库。

---

### 16. packages/util - 工具函数

**包名**: `@opencode-ai/util`

**主要功能**:
- 通用工具函数库
- 类型安全的工具
- 错误处理、编码、路径处理等

**技术栈**:
- TypeScript
- Zod

**依赖关系**:
- **被依赖**: 被几乎所有包依赖

**关键文件/模块**:
- `src/fn.ts` - 函数工具
- `src/error.ts` - 错误类型
- `src/encode.ts` - 编码工具
- `src/binary.ts` - 二进制处理
- `src/path.ts` - 路径处理
- `src/iife.ts` - IIFE 工具
- `src/lazy.ts` - 懒加载
- `src/identifier.ts` - 标识符生成
- `src/retry.ts` - 重试逻辑

**地位**: 最底层的工具包。

---

### 17. packages/script - 脚本工具

**包名**: `@opencode-ai/script`

**主要功能**:
- 构建和发布脚本工具
- 版本管理
- Bun 版本验证
- 预览版本生成

**技术栈**:
- Bun

**依赖关系**:
- **被依赖**: 被构建脚本使用

**关键文件/模块**:
- `src/index.ts` - 版本和渠道管理
  - 读取 git 分支确定发布渠道
  - 生成预览版本号（0.0.0-CHANNEL-DATE）
  - 从 npm 获取最新版本并递增

**导出**:
- `Script.channel` - 发布渠道（latest 或分支名）
- `Script.version` - 版本号
- `Script.preview` - 是否为预览版本

**地位**: 构建和发布工具。

---

### 18. packages/web - Web 服务

**包名**: `@opencode-ai/web`

**主要功能**:
- OpenCode 官方文档网站
- 基于 Astro 和 Starlight
- Markdown 内容管理
- 代码示例和 API 文档

**技术栈**:
- Astro 5.7.13
- Starlight（文档主题）
- SolidJS（交互组件）
- Shiki（代码高亮）
- TailwindCSS

**依赖关系**:
- **依赖**: `opencode`（CLI，用于文档示例）

**关键文件/模块**:
- `src/content.config.ts` - 内容配置
- `src/pages/[...slug].md.ts` - Markdown 页面
- `src/content/docs/` - 文档内容

**地位**: 文档站点。

---

### 19. packages/plugin - 插件系统

**包名**: `@opencode-ai/plugin`

**主要功能**:
- 定义插件 API 和类型
- 提供工具定义规范
- 支持自定义认证方法
- 生命周期钩子系统

**技术栈**:
- TypeScript
- Zod（验证）

**依赖关系**:
- **依赖**: `@opencode-ai/sdk`
- **被依赖**: 被 CLI 和其他扩展使用

**关键文件/模块**:
- `src/index.ts` - 插件类型定义
  - `Plugin` - 插件函数类型
  - `Hooks` - 可用的生命周期钩子
  - `AuthHook` - 自定义认证钩子
- `src/tool.ts` - 工具定义类型
- `src/shell.ts` - Bun shell 类型
- `src/example.ts` - 示例实现

**支持的生命周期钩子**:
- `event` - 事件处理
- `config` - 配置修改
- `tool` - 自定义工具
- `auth` - 自定义认证
- `chat.message` - 消息接收
- `chat.params` - LLM 参数修改
- `permission.ask` - 权限询问
- `tool.execute.before/after` - 工具执行前后
- `experimental.*` - 实验性钩子

**地位**: 插件系统的定义。

---

## 架构总结

### 核心架构层次

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层                               │
├─────────────────────────────────────────────────────────────┤
│  packages/app (Web)  │  packages/desktop (桌面)  │  VS Code  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        核心层                                 │
├─────────────────────────────────────────────────────────────┤
│           packages/opencode (CLI 核心)                        │
│    + packages/plugin (插件) + packages/sdk/js (SDK)          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                      服务层                                   │
├─────────────────────────────────────────────────────────────┤
│  packages/console/* (管理控制台)  │  packages/function (同步)  │
│  packages/slack (Slack Bot)    │  github (GitHub Action)     │
│  packages/enterprise (企业版)   │  packages/web (文档)        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    基础设施层                                 │
├─────────────────────────────────────────────────────────────┤
│  packages/ui (UI 组件)  │  packages/util (工具)  │  packages/script (构建) │
└─────────────────────────────────────────────────────────────┘
```

### 依赖关系图

```
util
  ↓
sdk/js ← plugin
  ↓
opencode (CLI 核心)
  ↓
app → desktop
  ↓
console/* (管理控制台)

独立服务：
- function (SyncServer)
- slack (Slack Bot)
- github (GitHub Action)
- web (文档)
- vscode (扩展)
```

### 技术栈总结

#### 前端技术栈
- **框架**: SolidJS 生态（SolidJS 1.9.10、SolidStart、Solid Router）
- **样式**: TailwindCSS 4.1.11
- **UI 组件**: Kobalte（无障碍组件）
- **代码高亮**: Shiki 3.20.0
- **Markdown**: Marked 17.0.1
- **构建**: Vite 7.1.4

#### 后端技术栈
- **运行时**: Bun 1.3.5（主要）、Node.js
- **框架**: Hono 4.10.7
- **数据库**: Drizzle ORM 0.41.0 + PlanetScale (MySQL)
- **认证**: OpenAuth
- **支付**: Stripe 18.0.0
- **云服务**: Cloudflare Workers、Durable Objects、R2
- **AWS**: AWS SDK、STS

#### AI 技术栈
- **AI SDK**: Vercel AI SDK 5.0.97
- **提供商**: 多提供商支持（Anthropic、OpenAI、Google、Azure、Groq 等）
- **协议**: MCP (Model Context Protocol)

#### 桌面应用
- **框架**: Tauri 2.x
- **Web**: 封装 packages/app

#### 工具链
- **语言**: TypeScript 5.8.2
- **包管理**: Bun Workspaces
- **构建**: Turborepo（可选）
- **验证**: Zod 4.1.8
- **代码解析**: tree-sitter

### 包的职责分类

| 包名 | 类型 | 主要职责 |
|-----|------|---------|
| packages/opencode | 核心 | CLI 核心和 AI Agent 引擎 |
| packages/console/app | 服务 | 控制台 Web 应用和 API 网关 |
| packages/console/core | 服务 | 控制台数据层和业务逻辑 |
| packages/console/function | 服务 | 无服务器函数 |
| packages/console/mail | 服务 | 邮件服务 |
| packages/console/resource | 服务 | 资源抽象 |
| packages/app | 客户端 | Web 应用 |
| packages/desktop | 客户端 | 桌面应用 |
| sdks/vscode | 客户端 | VS Code 扩展 |
| packages/function | 集成 | 会话共享和同步服务 |
| packages/slack | 集成 | Slack Bot |
| github | 集成 | GitHub Action |
| packages/enterprise | 集成 | 企业版功能 |
| packages/sdk/js | 工具 | JavaScript/TypeScript SDK |
| packages/ui | 工具 | UI 组件库 |
| packages/util | 工具 | 工具函数库 |
| packages/script | 工具 | 构建和发布脚本 |
| packages/web | 工具 | 文档站点 |
| packages/plugin | 工具 | 插件系统定义 |

### 设计亮点

1. **清晰的层次结构**: 从底层工具到顶层应用，层次分明
2. **模块化设计**: 每个包职责单一，易于维护和扩展
3. **多客户端支持**: 同一套核心逻辑，支持 CLI、Web、桌面、VS Code
4. **丰富的集成**: 与 Slack、GitHub 等第三方服务深度集成
5. **类型安全**: 全面的 TypeScript 支持，自动生成 SDK
6. **现代化技术栈**: 采用最新的前端和后端技术
7. **无服务器架构**: 利用 Cloudflare Workers 和 Durable Objects
8. **插件系统**: 灵活的插件机制，支持自定义扩展

---

## 总结

OpenCode 项目采用了现代化的 Monorepo 架构，通过 19 个精心设计的包，实现了从 CLI 工具到完整 SaaS 平台的全栈解决方案。每个包都有明确的职责边界，通过清晰的依赖关系组织在一起，形成了高度模块化、可扩展的架构体系。

这种架构设计不仅支持多种客户端（CLI、Web、桌面、VS Code），还提供了丰富的第三方集成（Slack、GitHub），并通过插件系统支持无限扩展，是现代开源项目架构的优秀范例。
